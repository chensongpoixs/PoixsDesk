/***********************************************************************************************
	created: 		2019-03-02

	author:			chensong

	purpose:		log
	输赢不重要，答案对你们有什么意义才重要。

	光阴者，百代之过客也，唯有奋力奔跑，方能生风起时，是时代造英雄，英雄存在于时代。或许世人道你轻狂，可你本就年少啊。 看护好，自己的理想和激情。


	我可能会遇到很多的人，听他们讲好2多的故事，我来写成故事或编成歌，用我学来的各种乐器演奏它。
	然后还可能在一个国家遇到一个心仪我的姑娘，她可能会被我帅气的外表捕获，又会被我深邃的内涵吸引，在某个下雨的夜晚，她会全身淋透然后要在我狭小的住处换身上的湿衣服。
	3小时候后她告诉我她其实是这个国家的公主，她愿意向父皇求婚。我不得已告诉她我是穿越而来的男主角，我始终要回到自己的世界。
	然后我的身影慢慢消失，我看到她眼里的泪水，心里却没有任何痛苦，我才知道，原来我的心被丢掉了，我游历全世界的原因，就是要找回自己的本心。
	于是我开始有意寻找各种各样失去心的人，我变成一块砖头，一颗树，一滴水，一朵白云，去听大家为什么会失去自己的本心。
	我发现，刚出生的宝宝，本心还在，慢慢的，他们的本心就会消失，收到了各种黑暗之光的侵蚀。
	从一次争论，到嫉妒和悲愤，还有委屈和痛苦，我看到一只只无形的手，把他们的本心扯碎，蒙蔽，偷走，再也回不到主人都身边。
	我叫他本心猎手。他可能是和宇宙同在的级别 但是我并不害怕，我仔细回忆自己平淡的一生 寻找本心猎手的痕迹。
	沿着自己的回忆，一个个的场景忽闪而过，最后发现，我的本心，在我写代码的时候，会回来。
	安静，淡然，代码就是我的一切，写代码就是我本心回归的最好方式，我还没找到本心猎手，但我相信，顺着这个线索，我一定能顺藤摸瓜，把他揪出来。
	************************************************************************************************/


 /***********************************************************************************************
	created: 		2019-03-02
	
	author:			chensong
					
	purpose:		log
	输赢不重要，答案对你们有什么意义才重要。

	光阴者，百代之过客也，唯有奋力奔跑，方能生风起时，是时代造英雄，英雄存在于时代。或许世人道你轻狂，可你本就年少啊。 看护好，自己的理想和激情。


	我可能会遇到很多的人，听他们讲好2多的故事，我来写成故事或编成歌，用我学来的各种乐器演奏它。
	然后还可能在一个国家遇到一个心仪我的姑娘，她可能会被我帅气的外表捕获，又会被我深邃的内涵吸引，在某个下雨的夜晚，她会全身淋透然后要在我狭小的住处换身上的湿衣服。
	3小时候后她告诉我她其实是这个国家的公主，她愿意向父皇求婚。我不得已告诉她我是穿越而来的男主角，我始终要回到自己的世界。
	然后我的身影慢慢消失，我看到她眼里的泪水，心里却没有任何痛苦，我才知道，原来我的心被丢掉了，我游历全世界的原因，就是要找回自己的本心。
	于是我开始有意寻找各种各样失去心的人，我变成一块砖头，一颗树，一滴水，一朵白云，去听大家为什么会失去自己的本心。
	我发现，刚出生的宝宝，本心还在，慢慢的，他们的本心就会消失，收到了各种黑暗之光的侵蚀。
	从一次争论，到嫉妒和悲愤，还有委屈和痛苦，我看到一只只无形的手，把他们的本心扯碎，蒙蔽，偷走，再也回不到主人都身边。
	我叫他本心猎手。他可能是和宇宙同在的级别 但是我并不害怕，我仔细回忆自己平淡的一生 寻找本心猎手的痕迹。
	沿着自己的回忆，一个个的场景忽闪而过，最后发现，我的本心，在我写代码的时候，会回来。
	安静，淡然，代码就是我的一切，写代码就是我本心回归的最好方式，我还没找到本心猎手，但我相信，顺着这个线索，我一定能顺藤摸瓜，把他揪出来。
	************************************************************************************************/


#ifndef _C_CLIENT_H_
#define _C_CLIENT_H_
#include "cnet_types.h"
#include <cstdio>
#include <cstdlib>
//#include "cnoncopyable.h"
#include "casync_log.h"

#include <string>
#include "crtc_publisher.h" 
#include "csingleton.h"
namespace chen {

	/**
	*  @author chensong
	*  @date 2019-03-02
	*  @brief RTC客户端状态枚举（RTC Client State Enumeration）
	*  
	*  该枚举定义了RTC客户端的状态机。客户端在不同的状态下执行不同的操作，
	*  包括WebSocket连接、RTC会话建立、销毁等。
	*  
	*  状态转换图（State Transition Diagram）：
	*  
	*    0                   1                   2                   3
	*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  ERtc_None (初始状态)                                          |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |        |                                                       |
	*   |        v                                                       |
	*   |  ERtc_WebSocket_Init (WebSocket初始化)                         |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |        |                                                       |
	*   |        v                                                       |
	*   |  ERtc_WebSocket (WebSocket连接中)                              |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |        |                                                       |
	*   |        v                                                       |
	*   |  ERtc_WebSocket_Wait (等待WebSocket响应)                       |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |        |                                                       |
	*   |        v                                                       |
	*   |  ERtc_WebSocket_Close (WebSocket关闭)                         |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |        |                                                       |
	*   |        v                                                       |
	*   |  ERtc_Destory (销毁状态)                                       |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |        |                                                       |
	*   |        v                                                       |
	*   |  ERtc_Exit (退出状态)                                          |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*  
	*  @note 状态机用于管理RTC客户端的生命周期
	*  @note 状态转换由客户端主循环控制
	*/
	enum ERtc_Type
	{
		ERtc_None = 0,                ///< 初始状态，未初始化
		ERtc_WebSocket_Init,          ///< WebSocket初始化状态，正在建立连接
		ERtc_WebSocket,               ///< WebSocket已连接，正在进行信令交换
		ERtc_WebSocket_Close,         ///< WebSocket关闭状态
		ERtc_WebSocket_Destory,       ///< WebSocket销毁状态
		ERtc_WebSocket_Wait,          ///< WebSocket等待状态，等待服务器响应
		ERtc_Reset,                   ///< 重置状态，准备重新初始化
		ERtc_Destory,                 ///< 销毁状态，正在清理资源
		ERtc_Wait,                    ///< 等待状态，等待操作完成
		ERtc_Exit,                    ///< 退出状态，客户端准备退出
	};
	
	/**
	*  @author chensong
	*  @date 2019-03-02
	*  @brief RTC客户端类（RTC Client Class）
	*  
	*  crtc_client类用于管理WebRTC客户端连接。它负责WebSocket信令连接、
	*  创建RTC发布者、管理客户端状态等。
	*  
	*  客户端架构（Client Architecture）：
	*  
	*    0                   1                   2                   3
	*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |                        crtc_client                             |
	*   |  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
	*   |  | m_rtc_publisher: crtc_publisher                            | |
	*   |  |   - 负责创建PeerConnection                                  | |
	*   |  |   - 处理WebRTC信令                                          | |
	*   |  |   - 管理音视频轨道                                          | |
	*   |  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
	*   |  | WebSocket信令层                                             | |
	*   |  |   - 连接信令服务器                                          | |
	*   |  |   - 发送/接收SDP                                            | |
	*   |  |   - 处理信令消息                                            | |
	*   |  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
	*   |  | 状态管理: m_status (ERtc_Type)                             | |
	*   |  |   - 管理客户端生命周期                                       | |
	*   |  |   - 状态转换控制                                             | |
	*   |  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*  
	*  客户端工作流程（Client Workflow）：
	*  
	*    0                   1                   2                   3
	*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  1. init(gpu_index) - 初始化客户端                             |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  2. Loop(rtc_url) - 连接WebSocket信令服务器                     |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  3. WebSocket连接成功，创建Offer SDP                            |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  4. 发送Offer SDP到信令服务器                                   |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  5. 接收Answer SDP，设置Remote Description                      |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  6. ICE候选收集完成，建立媒体连接                               |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  7. 开始音视频数据传输                                         |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*  
	*  信令消息格式（Signaling Message Format）：
	*  
	*    0                   1                   2                   3
	*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  message_type: "offer" | "answer" | "ice-candidate"            |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  room_name: 房间名称 (UTF-8 string)                            |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  user_name: 用户名 (UTF-8 string)                              |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  sdp: SDP内容 (UTF-8 string)                                   |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*   |  ice_candidate: ICE候选信息 (JSON object)                       |
	*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	*  
	*  @note crtc_client实现crtc_publisher::clistener接口，接收RTC事件回调
	*  @note 客户端使用单例模式访问：s_rtc_client
	*  @note WebSocket信令用于交换SDP和ICE候选
	*  
	*  使用示例：
	*  @code
	*  // 初始化客户端
	*  s_rtc_client.init(0);
	*  // 连接到RTC服务器
	*  s_rtc_client.Loop("ws://example.com/rtc");
	*  @endcode
	*/
	class crtc_client : public crtc_publisher::clistener
	{
	public:
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 构造函数（Constructor）
		*  
		*  该构造函数用于创建RTC客户端实例。初始化所有成员变量为默认值。
		*  
		*  初始化说明：
		*  - m_stoped: 初始化为false，表示客户端未停止
		*  - m_status: 初始化为ERtc_None，表示未初始化状态
		*  - m_rtc_publisher: 初始化为空引用
		*  - m_room_name: 初始化为空字符串
		*  - m_user_name: 初始化为空字符串
		*  - m_websocket_timer: 初始化为0
		*  
		*  @note 构造函数使用explicit关键字，防止隐式转换
		*  @note 需要在构造后调用init()方法完成初始化
		*/
		explicit crtc_client() : m_stoped(false)
			, m_status(ERtc_None)
			, m_rtc_publisher()
			, m_room_name("")
			, m_user_name("")
			, m_websocket_timer(0)
		{
		}
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 析构函数（Destructor）
		*  
		*  该析构函数用于清理RTC客户端实例。会停止所有连接并释放资源。
		*  
		*  清理流程：
		*  1. 停止客户端主循环
		*  2. 关闭WebSocket连接
		*  3. 销毁RTC发布者
		*  4. 清理所有成员变量
		*  
		*  @note 析构函数会自动调用destroy()方法清理资源
		*/
		~crtc_client();
		
	public:
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 初始化客户端（Initialize Client）
		*  
		*  该方法用于初始化RTC客户端。创建RTC发布者并设置GPU索引。
		*  
		*  初始化流程（Initialization Flow）：
		*  
		*    0                   1                   2                   3
		*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  1. 创建crtc_publisher实例                                      |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  2. 设置GPU索引用于视频编码/解码                                |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  3. 初始化PeerConnectionFactory                                |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  4. 设置状态为ERtc_WebSocket_Init                               |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*  
		*  @param gpu_index GPU索引，用于指定使用的GPU设备（0表示第一个GPU）
		*  @return 返回true表示初始化成功，false表示初始化失败
		*  @note 需要在调用Loop()之前先调用init()
		*  @note GPU索引用于硬件加速视频编解码
		*  
		*  使用示例：
		*  @code
		*  if (s_rtc_client.init(0)) {
		*      // 初始化成功
		*  }
		*  @endcode
		*/
		bool init(uint32 gpu_index);
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 客户端主循环（Client Main Loop）
		*  
		*  该方法用于启动客户端主循环。连接到WebSocket信令服务器并开始
		*  信令交换和RTC会话建立。
		*  
		*  主循环流程（Main Loop Flow）：
		*  
		*    0                   1                   2                   3
		*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  1. 连接到WebSocket信令服务器 (rtc_url)                        |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  2. 等待连接成功，状态变为ERtc_WebSocket                       |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  3. 发送房间加入消息到信令服务器                               |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  4. 接收服务器响应，创建PeerConnection                         |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  5. 创建Offer SDP并发送到服务器                                |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  6. 接收Answer SDP，设置Remote Description                     |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  7. ICE候选收集完成，建立媒体连接                              |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  8. 持续处理信令消息和RTC事件                                  |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*  
		*  WebSocket消息格式（WebSocket Message Format）：
		*  
		*    0                   1                   2                   3
		*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  {                                                             |
		*   |    "type": "join" | "offer" | "answer" | "ice-candidate"      |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |    "room": "room_name"                                         |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |    "user": "user_name"                                         |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |    "sdp": "v=0\r\n..."                                         |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |    "candidate": {...}                                          |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  }                                                             |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*  
		*  @param rtc_url WebSocket信令服务器URL，格式："ws://host:port/path"
		*  @note 该方法会阻塞直到客户端停止或连接失败
		*  @note WebSocket连接用于信令交换，不用于媒体传输
		*  @note 媒体传输使用WebRTC的P2P连接
		*  
		*  使用示例：
		*  @code
		*  s_rtc_client.Loop("ws://example.com:8080/rtc");
		*  @endcode
		*/
		void Loop(const char * rtc_url);
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 销毁客户端（Destroy Client）
		*  
		*  该方法用于销毁RTC客户端。停止所有连接并释放资源。
		*  
		*  销毁流程：
		*  1. 停止主循环
		*  2. 关闭WebSocket连接
		*  3. 销毁RTC发布者
		*  4. 清理所有资源
		*  
		*  @note 销毁后客户端无法再使用，需要重新初始化
		*/
		void destroy();

		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 停止客户端（Stop Client）
		*  
		*  该方法用于停止客户端主循环。设置停止标志，主循环会优雅退出。
		*  
		*  停止流程：
		*  1. 设置m_stoped标志为true
		*  2. 主循环检测到标志后退出
		*  3. 清理连接和资源
		*  
		*  @note 停止后可以重新调用Loop()恢复连接
		*/
		void stop();

	public:
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 发送创建的Offer SDP（Send Created Offer SDP）
		*  
		*  该方法是crtc_publisher::clistener接口的实现。当RTC发布者创建
		*  Offer SDP后，会调用此方法将SDP发送到信令服务器。
		*  
		*  SDP发送流程（SDP Sending Flow）：
		*  
		*    0                   1                   2                   3
		*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  1. RTC发布者创建Offer SDP                                    |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  2. 调用send_create_offer_sdp()方法                            |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  3. 构建WebSocket消息，包含SDP内容                             |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  4. 通过WebSocket发送消息到信令服务器                          |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  5. 等待服务器返回Answer SDP                                  |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*  
		*  SDP消息格式（SDP Message Format）：
		*  
		*    0                   1                   2                   3
		*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  {                                                             |
		*   |    "type": "offer",                                            |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |    "room": m_room_name,                                        |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |    "user": m_user_name,                                        |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |    "sdp": "v=0\r\no=- ..."                                     |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  }                                                             |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*  
		*  @param sdp Offer SDP字符串，包含媒体会话描述信息
		*  @param create 是否为创建新会话，true表示创建，false表示更新
		*  @note 该方法由crtc_publisher在创建Offer SDP后自动调用
		*  @note SDP通过WebSocket发送到信令服务器
		*  
		*  使用示例：
		*  @code
		*  // 由crtc_publisher自动调用，无需手动调用
		*  @endcode
		*/
		virtual void send_create_offer_sdp(const std::string& sdp, bool create = true);
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief RTC连接失败回调（RTC Connection Failed Callback）
		*  
		*  该方法是crtc_publisher::clistener接口的实现。当RTC连接失败时，
		*  会调用此方法进行错误处理。
		*  
		*  连接失败处理流程（Connection Failed Handling Flow）：
		*  
		*    0                   1                   2                   3
		*    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  1. RTC连接失败（ICE连接失败、信令错误等）                    |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  2. crtc_publisher调用connect_rtc_failed()                     |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  3. 记录错误日志                                              |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  4. 设置状态为ERtc_WebSocket_Close                             |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*   |  5. 可以尝试重新连接或报告错误                                |
		*   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		*  
		*  @note 该方法由crtc_publisher在连接失败时自动调用
		*  @note 连接失败后可以尝试重新连接或退出
		*  
		*  使用示例：
		*  @code
		*  // 由crtc_publisher自动调用，无需手动调用
		*  @endcode
		*/
		virtual void connect_rtc_failed();
		
	private:
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 处理消息列表（Process Message List）
		*  
		*  该私有方法用于处理消息列表。解析WebSocket接收的消息并执行相应操作。
		*  
		*  @param msgs 消息列表，包含待处理的消息字符串
		*  @note 该方法用于批量处理消息，提高处理效率
		*/
		void _presssmsg(std::list<std::string>& msgs);
		
	protected:
	private:
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 停止标志（Stop Flag）
		*  
		*  该成员变量用于指示客户端是否已停止。当设置为true时，主循环会退出。
		*  
		*  @note 初始化为false，表示客户端未停止
		*  @note 通过stop()方法设置为true
		*/
		bool													m_stoped;
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 客户端状态（Client Status）
		*  
		*  该成员变量用于存储客户端的当前状态。状态值来自ERtc_Type枚举。
		*  
		*  状态说明（Status Description）：
		*  - ERtc_None: 初始状态，未初始化
		*  - ERtc_WebSocket_Init: WebSocket初始化中
		*  - ERtc_WebSocket: WebSocket已连接
		*  - ERtc_WebSocket_Wait: 等待WebSocket响应
		*  - ERtc_WebSocket_Close: WebSocket已关闭
		*  - ERtc_Destory: 正在销毁
		*  - ERtc_Exit: 准备退出
		*  
		*  @note 初始化为ERtc_None
		*  @note 状态转换由主循环控制
		*/
		ERtc_Type												m_status;
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief RTC发布者（RTC Publisher）
		*  
		*  该成员变量用于存储RTC发布者的智能指针。RTC发布者负责创建和管理
		*  WebRTC PeerConnection，处理信令和媒体传输。
		*  
		*  RTC发布者功能（RTC Publisher Functions）：
		*  - 创建和管理PeerConnection
		*  - 处理SDP创建和交换
		*  - 管理音视频轨道
		*  - 处理ICE候选
		*  - 管理数据通道
		*  
		*  @note 使用webrtc::scoped_refptr管理引用计数
		*  @note 在init()方法中创建
		*/
		webrtc::scoped_refptr < chen::crtc_publisher>				m_rtc_publisher;
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 房间名称（Room Name）
		*  
		*  该成员变量用于存储房间名称。房间名称用于标识客户端加入的房间。
		*  
		*  @note 初始化为空字符串
		*  @note 房间名称通过信令消息设置
		*/
		std::string												m_room_name;
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief 用户名称（User Name）
		*  
		*  该成员变量用于存储用户名称。用户名称用于标识客户端用户。
		*  
		*  @note 初始化为空字符串
		*  @note 用户名称通过信令消息设置
		*/
		std::string												m_user_name;
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief WebSocket定时器（WebSocket Timer）
		*  
		*  该成员变量用于存储WebSocket定时器ID。定时器用于处理超时和重连。
		*  
		*  @note 初始化为0，表示未设置定时器
		*  @note 定时器用于WebSocket连接超时检测
		*/
		uint32													m_websocket_timer;
		
		/**
		*  @author chensong
		*  @date 2019-03-02
		*  @brief RTC服务器URL（RTC Server URL）
		*  
		*  该成员变量用于存储RTC服务器的WebSocket URL。URL格式为：
		*  "ws://host:port/path" 或 "wss://host:port/path"。
		*  
		*  URL格式说明（URL Format Description）：
		*  - ws://: 非加密WebSocket协议
		*  - wss://: 加密WebSocket协议（TLS）
		*  - host: 服务器主机名或IP地址
		*  - port: 服务器端口号
		*  - path: WebSocket路径
		*  
		*  @note 在Loop()方法中设置
		*  @note URL用于连接到信令服务器
		*/
		std::string rtc_url_;
	};

#define  s_rtc_client chen::csingleton<chen::crtc_client>::get_instance()
}


#endif 